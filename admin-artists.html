<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arclead Artists Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .admin-section {
            padding: 30px;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .control-group {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .control-group h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-primary { background: linear-gradient(135deg, #3498db, #2980b9); }
        .btn-success { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .btn-warning { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .btn-danger { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .btn-small { padding: 8px 15px; font-size: 14px; margin: 2px; }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-control:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }

        textarea.form-control {
            height: 100px;
            resize: vertical;
        }

        .artists-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .artist-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .artist-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .artist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .artist-name {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.2em;
        }

        .artist-images {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .artist-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
            border: 2px solid #ddd;
        }

        .filmography-section {
            margin-top: 10px;
        }

        .filmography-category {
            margin-bottom: 10px;
        }

        .category-title {
            font-weight: bold;
            color: #667eea;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .works-list {
            font-size: 0.8em;
            color: #555;
            line-height: 1.4;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }

        .close:hover {
            color: #000;
        }

        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            display: none;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .filmography-input {
            margin-bottom: 15px;
        }

        .year-works {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: flex-start;
        }

        .year-input {
            width: 80px;
            flex-shrink: 0;
        }

        .works-input {
            flex: 1;
        }

        @media (max-width: 768px) {
            .controls {
                grid-template-columns: 1fr;
            }
            
            .artists-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 2% auto;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎭 Arclead Artists Admin</h1>
            <p>아티스트 정보 및 필모그래피 관리</p>
        </div>

        <div class="admin-section">
            <div class="status" id="status"></div>
            
            <div class="controls">
                <div class="control-group">
                    <h3>👥 아티스트 관리</h3>
                    <button class="btn btn-primary" onclick="openAddArtistModal()">➕ 새 아티스트 추가</button>
                    <button class="btn" onclick="refreshArtistsList()">🔄 목록 새로고침</button>
                </div>

                <div class="control-group">
                    <h3>📊 통계</h3>
                    <p id="artistStats">총 아티스트: <span id="totalArtists">0</span>명</p>
                    <button class="btn btn-warning" onclick="exportData()">📁 데이터 내보내기</button>
                    <button class="btn btn-success" onclick="document.getElementById('importFile').click()">📂 데이터 가져오기</button>
                    <input type="file" id="importFile" style="display: none;" accept=".json" onchange="importData(this)">
                </div>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>처리 중...</p>
            </div>

            <div id="artistsContainer">
                <h3>🎬 등록된 아티스트</h3>
                <div class="artists-grid" id="artistsGrid">
                    <!-- Artists will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Artist Modal -->
    <div id="artistModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">아티스트 추가</h2>
                <span class="close" onclick="closeArtistModal()">&times;</span>
            </div>
            <form id="artistForm">
                <div class="form-group">
                    <label for="artistId">아티스트 ID (영문, 숫자, - 만 사용)</label>
                    <input type="text" id="artistId" class="form-control" required pattern="[a-zA-Z0-9-]+">
                </div>
                <div class="form-group">
                    <label for="artistName">한글 이름</label>
                    <input type="text" id="artistName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="artistNameEn">영문 이름 (선택)</label>
                    <input type="text" id="artistNameEn" class="form-control">
                </div>
                <div class="form-group">
                    <label for="artistImages">이미지 파일 업로드</label>
                    <input type="file" id="artistImages" class="form-control" multiple accept="image/*">
                    <small>여러 이미지를 선택할 수 있습니다.</small>
                </div>

                <h4>필모그래피</h4>
                
                <div class="filmography-input">
                    <h5>영화</h5>
                    <div id="moviesContainer">
                        <div class="year-works">
                            <input type="text" class="form-control year-input" placeholder="년도">
                            <textarea class="form-control works-input" placeholder="작품명 (여러 작품은 줄바꿈으로 구분)"></textarea>
                        </div>
                    </div>
                    <button type="button" class="btn btn-small" onclick="addYearWorks('moviesContainer')">+ 년도 추가</button>
                </div>

                <div class="filmography-input">
                    <h5>드라마</h5>
                    <div id="dramasContainer">
                        <div class="year-works">
                            <input type="text" class="form-control year-input" placeholder="년도">
                            <textarea class="form-control works-input" placeholder="작품명 (여러 작품은 줄바꿈으로 구분)"></textarea>
                        </div>
                    </div>
                    <button type="button" class="btn btn-small" onclick="addYearWorks('dramasContainer')">+ 년도 추가</button>
                </div>

                <div class="filmography-input">
                    <h5>광고</h5>
                    <div id="commercialsContainer">
                        <div class="year-works">
                            <input type="text" class="form-control year-input" placeholder="년도">
                            <textarea class="form-control works-input" placeholder="작품명 (여러 작품은 줄바꿈으로 구분)"></textarea>
                        </div>
                    </div>
                    <button type="button" class="btn btn-small" onclick="addYearWorks('commercialsContainer')">+ 년도 추가</button>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button type="submit" class="btn btn-success">💾 저장</button>
                    <button type="button" class="btn" onclick="closeArtistModal()">❌ 취소</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let allArtists = [];
        let editingArtist = null;

        // Show status message
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 5000);
        }

        // Show/hide loading
        function setLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // Load artists list
        async function refreshArtistsList() {
            setLoading(true);
            try {
                const response = await fetch('/api/artists');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                allArtists = await response.json();
                renderArtists(allArtists);
                updateStats();
                showStatus(`${allArtists.length}명의 아티스트를 불러왔습니다.`, 'success');
            } catch (error) {
                console.error('Error loading artists:', error);
                showStatus('아티스트 목록을 불러오는데 실패했습니다: ' + error.message, 'error');
            }
            setLoading(false);
        }

        // Render artists
        function renderArtists(artists) {
            const grid = document.getElementById('artistsGrid');
            
            if (artists.length === 0) {
                grid.innerHTML = '<p style="text-align: center; color: #6c757d; grid-column: 1/-1;">등록된 아티스트가 없습니다.</p>';
                return;
            }

            grid.innerHTML = artists.map(artist => `
                <div class="artist-card">
                    <div class="artist-header">
                        <div class="artist-name">${artist.name}</div>
                        <div>
                            <button class="btn btn-warning btn-small" onclick="editArtist('${artist.id}')">✏️ 수정</button>
                            <button class="btn btn-danger btn-small" onclick="deleteArtist('${artist.id}')">🗑️ 삭제</button>
                        </div>
                    </div>
                    
                    <div><strong>ID:</strong> ${artist.id}</div>
                    ${artist.nameEn ? `<div><strong>영문명:</strong> ${artist.nameEn}</div>` : ''}
                    
                    <div class="artist-images">
                        ${(artist.images || []).slice(0, 4).map(img => 
                            `<img src="/assets/artists/${artist.id}/${img}" class="artist-image" alt="${artist.name}">`
                        ).join('')}
                        ${(artist.images || []).length > 4 ? `<div style="display: flex; align-items: center; color: #666;">+${(artist.images || []).length - 4}</div>` : ''}
                    </div>

                    <div class="filmography-section">
                        ${Object.entries(artist.filmography || {}).map(([category, works]) => {
                            const categoryName = { movies: '영화', dramas: '드라마', commercials: '광고' }[category];
                            const workCount = Object.values(works).reduce((acc, workList) => acc + (Array.isArray(workList) ? workList.length : 1), 0);
                            return workCount > 0 ? `
                                <div class="filmography-category">
                                    <div class="category-title">${categoryName} (${workCount}편)</div>
                                    <div class="works-list">${Object.entries(works).slice(0, 2).map(([year, workList]) => 
                                        `${year}: ${Array.isArray(workList) ? workList[0] + (workList.length > 1 ? ' 외 ' + (workList.length - 1) + '편' : '') : workList}`
                                    ).join('<br>')}</div>
                                </div>
                            ` : '';
                        }).join('')}
                    </div>
                </div>
            `).join('');
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalArtists').textContent = allArtists.length;
        }

        // Open add artist modal
        function openAddArtistModal() {
            editingArtist = null;
            document.getElementById('modalTitle').textContent = '새 아티스트 추가';
            document.getElementById('artistForm').reset();
            clearFilmographyContainers();
            document.getElementById('artistModal').style.display = 'block';
        }

        // Close artist modal
        function closeArtistModal() {
            document.getElementById('artistModal').style.display = 'none';
            editingArtist = null;
        }

        // Clear filmography containers
        function clearFilmographyContainers() {
            ['moviesContainer', 'dramasContainer', 'commercialsContainer'].forEach(containerId => {
                const container = document.getElementById(containerId);
                container.innerHTML = `
                    <div class="year-works">
                        <input type="text" class="form-control year-input" placeholder="년도">
                        <textarea class="form-control works-input" placeholder="작품명 (여러 작품은 줄바꿈으로 구분)"></textarea>
                    </div>
                `;
            });
        }

        // Add year-works input
        function addYearWorks(containerId) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = 'year-works';
            div.innerHTML = `
                <input type="text" class="form-control year-input" placeholder="년도">
                <textarea class="form-control works-input" placeholder="작품명 (여러 작품은 줄바꿈으로 구분)"></textarea>
                <button type="button" class="btn btn-danger btn-small" onclick="this.parentElement.remove()">✕</button>
            `;
            container.appendChild(div);
        }

        // Collect filmography data
        function collectFilmographyData() {
            const filmography = {};
            
            ['movies', 'dramas', 'commercials'].forEach(category => {
                const containerId = category + 'Container';
                const container = document.getElementById(containerId);
                const yearWorksElements = container.querySelectorAll('.year-works');
                
                filmography[category] = {};
                
                yearWorksElements.forEach(element => {
                    const yearInput = element.querySelector('.year-input');
                    const worksInput = element.querySelector('.works-input');
                    
                    const year = yearInput.value.trim();
                    const works = worksInput.value.trim();
                    
                    if (year && works) {
                        filmography[category][year] = works.split('\n').map(w => w.trim()).filter(w => w);
                    }
                });
            });
            
            return filmography;
        }

        // Handle form submission
        document.getElementById('artistForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            const artistData = {
                id: document.getElementById('artistId').value.trim(),
                name: document.getElementById('artistName').value.trim(),
                nameEn: document.getElementById('artistNameEn').value.trim(),
                filmography: collectFilmographyData()
            };

            // Validate ID format
            if (!/^[a-zA-Z0-9-]+$/.test(artistData.id)) {
                showStatus('아티스트 ID는 영문, 숫자, - 만 사용할 수 있습니다.', 'error');
                return;
            }

            // Check for duplicate ID (when adding new)
            if (!editingArtist && allArtists.some(a => a.id === artistData.id)) {
                showStatus('이미 존재하는 아티스트 ID입니다.', 'error');
                return;
            }

            formData.append('artistData', JSON.stringify(artistData));
            
            // Add images
            const imageFiles = document.getElementById('artistImages').files;
            for (let i = 0; i < imageFiles.length; i++) {
                formData.append('images', imageFiles[i]);
            }

            setLoading(true);
            try {
                const url = editingArtist ? `/api/artists/${editingArtist}` : '/api/artists';
                const method = editingArtist ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    body: formData
                });

                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const result = await response.json();
                showStatus(editingArtist ? '아티스트 정보가 수정되었습니다.' : '새 아티스트가 추가되었습니다.', 'success');
                
                closeArtistModal();
                refreshArtistsList();
                
            } catch (error) {
                console.error('Error saving artist:', error);
                showStatus('아티스트 저장에 실패했습니다: ' + error.message, 'error');
            }
            setLoading(false);
        });

        // Edit artist
        async function editArtist(artistId) {
            const artist = allArtists.find(a => a.id === artistId);
            if (!artist) return;

            editingArtist = artistId;
            document.getElementById('modalTitle').textContent = '아티스트 수정';
            
            // Fill form
            document.getElementById('artistId').value = artist.id;
            document.getElementById('artistName').value = artist.name;
            document.getElementById('artistNameEn').value = artist.nameEn || '';
            
            // Clear and fill filmography
            clearFilmographyContainers();
            
            if (artist.filmography) {
                Object.entries(artist.filmography).forEach(([category, works]) => {
                    const containerId = category + 'Container';
                    const container = document.getElementById(containerId);
                    container.innerHTML = '';
                    
                    if (Object.keys(works).length > 0) {
                        Object.entries(works).forEach(([year, workList]) => {
                            const div = document.createElement('div');
                            div.className = 'year-works';
                            div.innerHTML = `
                                <input type="text" class="form-control year-input" value="${year}">
                                <textarea class="form-control works-input">${Array.isArray(workList) ? workList.join('\n') : workList}</textarea>
                                <button type="button" class="btn btn-danger btn-small" onclick="this.parentElement.remove()">✕</button>
                            `;
                            container.appendChild(div);
                        });
                    } else {
                        container.innerHTML = `
                            <div class="year-works">
                                <input type="text" class="form-control year-input" placeholder="년도">
                                <textarea class="form-control works-input" placeholder="작품명 (여러 작품은 줄바꿈으로 구분)"></textarea>
                            </div>
                        `;
                    }
                });
            }
            
            document.getElementById('artistModal').style.display = 'block';
        }

        // Delete artist
        async function deleteArtist(artistId) {
            const artist = allArtists.find(a => a.id === artistId);
            if (!artist) return;

            if (!confirm(`"${artist.name}" 아티스트를 삭제하시겠습니까?\n\n모든 이미지와 정보가 영구적으로 삭제됩니다.`)) return;

            setLoading(true);
            try {
                const response = await fetch(`/api/artists/${artistId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                showStatus(`"${artist.name}" 아티스트가 삭제되었습니다.`, 'success');
                refreshArtistsList();
                
            } catch (error) {
                console.error('Error deleting artist:', error);
                showStatus('아티스트 삭제에 실패했습니다: ' + error.message, 'error');
            }
            setLoading(false);
        }

        // Export data
        function exportData() {
            const dataStr = JSON.stringify(allArtists, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `arclead-artists-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // Import data
        async function importData(input) {
            const file = input.files[0];
            if (!file) return;

            try {
                const text = await file.text();
                const importedArtists = JSON.parse(text);
                
                if (!Array.isArray(importedArtists)) {
                    throw new Error('잘못된 파일 형식입니다.');
                }

                if (confirm(`${importedArtists.length}명의 아티스트 데이터를 가져오시겠습니까?\n\n기존 데이터는 유지됩니다.`)) {
                    // Here you would send the data to the server
                    showStatus(`${importedArtists.length}명의 아티스트 데이터를 가져왔습니다.`, 'success');
                }
                
            } catch (error) {
                showStatus('파일을 읽는데 실패했습니다: ' + error.message, 'error');
            }
            
            input.value = '';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            refreshArtistsList();
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('artistModal');
            if (event.target === modal) {
                closeArtistModal();
            }
        }
    </script>
</body>
</html> 